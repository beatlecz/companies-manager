// Generated by CoffeeScript 1.6.3
var OwnersCtrl;

OwnersCtrl = function($scope, Api, $routeParams, $upload) {
  $scope.owner = new Api.owners({
    company_id: $routeParams.company_id
  });
  $scope.editing = false;
  $scope.editToggle = function() {
    return $scope.editing = !$scope.editing;
  };
  $scope.loadData = function() {
    return $scope.owners = Api.owners.query({
      company_id: $routeParams.company_id
    });
  };
  $scope.fileSelected = function($files) {
    return $scope.attachment = $files[0];
  };
  $scope["delete"] = function(o) {
    return o.$delete(function() {
      return $scope.loadData();
    });
  };
  $scope.save = function(o) {
    return o.$save(function() {
      $upload.upload({
        url: '/companies/' + o.company_id + '/owners/' + o.id + '/attachment',
        file: $scope.attachment
      }).success((function(data) {
        o.attachment_url = data;
        $scope.attachment = null;
        $scope.editing = false;
        return $('#attachment').val('');
      }));
      $scope.owners.push(o);
      return $scope.owner = new Api.owners({
        company_id: $routeParams.company_id
      });
    });
  };
  if ($routeParams.company_id !== 'new') {
    return $scope.loadData();
  }
};
